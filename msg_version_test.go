package main

import (
	"bytes"
	"testing"
)

func TestMsgVersion(t *testing.T) {
	msg := []byte{
		0xf9, 0xbe, 0xb4, 0xd9, 0x76, 0x65, 0x72, 0x73,
		0x69, 0x6f, 0x6e, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x64, 0x00, 0x00, 0x00, 0x35, 0x8d, 0x49, 0x32,
		0x62, 0xea, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x11, 0xb2, 0xd0, 0x50,
		0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x3b, 0x2e, 0xb3, 0x5d, 0x8c, 0xe6, 0x17, 0x65,
		0x0f, 0x2f, 0x53, 0x61, 0x74, 0x6f, 0x73, 0x68,
		0x69, 0x3a, 0x30, 0x2e, 0x37, 0x2e, 0x32, 0x2f,
		0xc0, 0x3e, 0x03, 0x00,
	}

	b := bytes.NewBuffer(msg)

	t.Run("decode", func(t *testing.T) {
		msgVersion := &MsgVersion{}

		err := msgVersion.Decode(b)
		if err != nil {
			t.Errorf("Could not decode")
		}

		expectedVersion := 0xea62
		if msgVersion.Version != uint32(expectedVersion) {
			t.Errorf("Wrong version decode: actual (0x%x), expected (0x%x)", msgVersion.Version, expectedVersion)
		}
	})
}
